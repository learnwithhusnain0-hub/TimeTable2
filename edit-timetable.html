<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Timetable - Allied School</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- WhatsApp Button -->
    <a href="https://wa.me/923038776223" class="whatsapp-btn" target="_blank">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="navbar glass">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Allied School</span>
                </div>
                <div class="nav-links">
                    <a href="index.html"><i class="fas fa-home"></i> Home</a>
                    <a href="classes.html"><i class="fas fa-users"></i> Classes</a>
                    <a href="admin-dashboard.html"><i class="fas fa-user-cog"></i> Admin</a>
                    <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Edit Timetable Header -->
    <section class="page-header">
        <div class="container">
            <div class="edit-header">
                <div>
                    <h1 id="editTitle">Edit Timetable</h1>
                    <p id="editDescription">Modify class schedule and timings</p>
                </div>
                <div class="edit-actions">
                    <button class="btn btn-outline" onclick="addNewPeriod()">
                        <i class="fas fa-plus"></i> Add Period
                    </button>
                    <a href="admin-dashboard.html" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i> Back to Dashboard
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Class Selection -->
    <section class="class-selection-edit">
        <div class="container">
            <div class="selection-container glass">
                <h3><i class="fas fa-filter"></i> Select Class to Edit</h3>
                <div class="class-selector">
                    <select id="classSelector" onchange="loadClassForEdit(this.value)">
                        <option value="">Select a Class</option>
                        <option value="1">Class 1</option>
                        <option value="2">Class 2</option>
                        <option value="3">Class 3</option>
                        <option value="4">Class 4</option>
                        <option value="5">Class 5</option>
                        <option value="6">Class 6</option>
                        <option value="7">Class 7</option>
                        <option value="8">Class 8</option>
                        <option value="9">Class 9</option>
                        <option value="10">Class 10</option>
                    </select>
                </div>
            </div>
        </div>
    </section>

    <!-- Timetable Editor -->
    <section class="timetable-editor">
        <div class="container">
            <div class="editor-container glass">
                <div class="editor-header">
                    <h2><i class="fas fa-edit"></i> Timetable Editor</h2>
                    <div class="schedule-tabs">
                        <button class="tab-btn active" onclick="switchTab('monfri')">Monday-Friday</button>
                        <button class="tab-btn" onclick="switchTab('saturday')">Saturday</button>
                    </div>
                </div>

                <!-- Monday-Friday Editor -->
                <div id="monfri-editor" class="editor-content active">
                    <div class="editor-actions">
                        <button class="btn btn-primary" onclick="saveTimetable('monfri')">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="btn btn-outline" onclick="resetTimetable('monfri')">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                    <div class="timetable-edit" id="monfri-edit-content">
                        <!-- Editable timetable will be loaded here -->
                    </div>
                </div>

                <!-- Saturday Editor -->
                <div id="saturday-editor" class="editor-content">
                    <div class="editor-actions">
                        <button class="btn btn-primary" onclick="saveTimetable('saturday')">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="btn btn-outline" onclick="resetTimetable('saturday')">
                            <i class="fas fa-undo"></i> Reset
                        </button>
                    </div>
                    <div class="timetable-edit" id="saturday-edit-content">
                        <!-- Editable timetable will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Allied School</h3>
                    <p>Providing quality education with modern technology and innovative teaching methods since 1995.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="classes.html"><i class="fas fa-chevron-right"></i> Classes</a></li>
                        <li><a href="admin-dashboard.html"><i class="fas fa-chevron-right"></i> Admin</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <ul>
                        <li><a href="#"><i class="fas fa-map-marker-alt"></i> 123 Education Street, City</a></li>
                        <li><a href="tel:+923001234567"><i class="fas fa-phone"></i> +92 300 1234567</a></li>
                        <li><a href="mailto:info@alliedschool.edu"><i class="fas fa-envelope"></i> info@alliedschool.edu</a></li>
                        <li><a href="https://wa.me/923038776223" target="_blank"><i class="fab fa-whatsapp"></i> WhatsApp Support</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Allied School Timetable System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        let currentClass = '';
        let currentTab = 'monfri';

        // Check admin login
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (!isLoggedIn) {
                window.location.href = 'admin-login.html';
            }

            // Load class from URL parameter if present
            const urlParams = new URLSearchParams(window.location.search);
            const classId = urlParams.get('class');
            if (classId) {
                document.getElementById('classSelector').value = classId;
                loadClassForEdit(classId);
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function(e) {
            e.preventDefault();
            localStorage.removeItem('adminLoggedIn');
            window.location.href = 'admin-login.html';
        });

        function loadClassForEdit(classId) {
            if (!classId) return;
            
            currentClass = classId;
            document.getElementById('editTitle').textContent = `Edit Class ${classId} Timetable`;
            document.getElementById('editDescription').textContent = 'Modify schedule and timings';
            
            loadTimetableForEdit('monfri', classId);
            loadTimetableForEdit('saturday', classId);
        }

        function loadTimetableForEdit(type, classId) {
            const container = document.getElementById(`${type}-edit-content`);
            const classData = JSON.parse(localStorage.getItem(`class${classId}Data`)) || getDefaultClassData(classId);
            const timetable = classData[type];
            
            let html = `
                <div class="edit-table-header">
                    <div>Time</div>
                    <div>Subject</div>
                    <div>Teacher</div>
                    <div>Room</div>
                    <div>Actions</div>
                </div>
            `;
            
            timetable.forEach((period, index) => {
                html += `
                    <div class="edit-table-row" data-index="${index}">
                        <div>
                            <input type="time" value="${period.time.split(' - ')[0]}" class="time-input start-time">
                            <span> - </span>
                            <input type="time" value="${period.time.split(' - ')[1]}" class="time-input end-time">
                        </div>
                        <div><input type="text" value="${period.subject}" class="subject-input"></div>
                        <div><input type="text" value="${period.teacher}" class="teacher-input"></div>
                        <div><input type="text" value="${period.room}" class="room-input"></div>
                        <div>
                            <button class="btn-icon danger" onclick="deletePeriod('${type}', ${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn-icon" onclick="movePeriod('${type}', ${index}, 'up')">
                                <i class="fas fa-arrow-up"></i>
                            </button>
                            <button class="btn-icon" onclick="movePeriod('${type}', ${index}, 'down')">
                                <i class="fas fa-arrow-down"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.editor-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`.tab-btn[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-editor`).classList.add('active');
        }

        function addNewPeriod() {
            if (!currentClass) {
                alert('Please select a class first!');
                return;
            }
            
            const container = document.getElementById(`${currentTab}-edit-content`);
            const newIndex = container.querySelectorAll('.edit-table-row').length;
            
            const newRow = document.createElement('div');
            newRow.className = 'edit-table-row';
            newRow.setAttribute('data-index', newIndex);
            newRow.innerHTML = `
                <div>
                    <input type="time" value="08:00" class="time-input start-time">
                    <span> - </span>
                    <input type="time" value="08:45" class="time-input end-time">
                </div>
                <div><input type="text" value="New Subject" class="subject-input"></div>
                <div><input type="text" value="Teacher Name" class="teacher-input"></div>
                <div><input type="text" value="Room" class="room-input"></div>
                <div>
                    <button class="btn-icon danger" onclick="deletePeriod('${currentTab}', ${newIndex})">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn-icon" onclick="movePeriod('${currentTab}', ${newIndex}, 'up')">
                        <i class="fas fa-arrow-up"></i>
                    </button>
                    <button class="btn-icon" onclick="movePeriod('${currentTab}', ${newIndex}, 'down')">
                        <i class="fas fa-arrow-down"></i>
                    </button>
                </div>
            `;
            
            container.appendChild(newRow);
        }

        function deletePeriod(type, index) {
            if (confirm('Are you sure you want to delete this period?')) {
                const container = document.getElementById(`${type}-edit-content`);
                const row = container.querySelector(`[data-index="${index}"]`);
                if (row) {
                    row.remove();
                    // Reindex remaining rows
                    const rows = container.querySelectorAll('.edit-table-row');
                    rows.forEach((row, newIndex) => {
                        row.setAttribute('data-index', newIndex);
                    });
                }
            }
        }

        function saveTimetable(type) {
            if (!currentClass) {
                alert('Please select a class first!');
                return;
            }
            
            const container = document.getElementById(`${type}-edit-content`);
            const rows = container.querySelectorAll('.edit-table-row');
            const timetable = [];
            
            rows.forEach(row => {
                const startTime = row.querySelector('.start-time').value;
                const endTime = row.querySelector('.end-time').value;
                const subject = row.querySelector('.subject-input').value;
                const teacher = row.querySelector('.teacher-input').value;
                const room = row.querySelector('.room-input').value;
                
                timetable.push({
                    time: `${startTime} - ${endTime}`,
                    subject: subject,
                    teacher: teacher,
                    room: room
                });
            });
            
            // Save to localStorage
            let classData = JSON.parse(localStorage.getItem(`class${currentClass}Data`)) || getDefaultClassData(currentClass);
            classData[type] = timetable;
            localStorage.setItem(`class${currentClass}Data`, JSON.stringify(classData));
            
            alert('Timetable saved successfully!');
        }

        function getDefaultClassData(classId) {
            // Return default data structure
            return {
                description: `Class ${classId} timetable`,
                monfri: [],
                saturday: [],
                teachers: []
            };
        }
    </script>
</body>
</html>
